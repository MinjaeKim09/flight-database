{% extends "base.html" %}

{% block title %}Find Flights - SkyHigh{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card mb-5">
            <div class="card-body p-5">
                <h2 class="fw-bold mb-4">Where to next?</h2>
                <form method="POST" action="{{ url_for('customer_search') }}">
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">From</label>
                            <input type="text" class="form-control" name="departure_city" placeholder="City">
                            <input type="text" class="form-control mt-2" name="departure_airport" placeholder="Airport Code (e.g. JFK)">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">To</label>
                            <input type="text" class="form-control" name="arrival_city" placeholder="City">
                            <input type="text" class="form-control mt-2" name="arrival_airport" placeholder="Airport Code (e.g. LHR)">
                        </div>
                    </div>
                    
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Departure</label>
                            <input type="date" class="form-control" name="departure_date">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Return (Optional)</label>
                            <input type="date" class="form-control" name="return_date">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="round_trip" id="round_trip">
                            <label class="form-check-label" for="round_trip">Round Trip</label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 py-3" style="font-size: 16px; border-radius: 12px;">Search Flights</button>
                </form>
            </div>
        </div>

        {% if flights %}
        <h4 class="mb-4 fw-bold">Available Flights</h4>
        <div class="d-flex flex-column gap-3">
            {% for flight in flights %}
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <h5 class="mb-0 fw-bold">{{ flight.airline_name }}</h5>
                            <small class="text-secondary">{{ flight.flight_number }}</small>
                        </div>
                        <div class="col-md-5">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="text-center">
                                    <div class="fs-4 fw-bold">{{ flight.departure_timestamp.strftime('%H:%M') }}</div>
                                    <small class="text-secondary">{{ flight.departure_airport }}</small>
                                </div>
                                <div class="text-center px-3">
                                    <span class="text-secondary" style="font-size: 20px;">✈</span>
                                </div>
                                <div class="text-center">
                                    <div class="fs-4 fw-bold">{{ flight.arrival_timestamp.strftime('%H:%M') }}</div>
                                    <small class="text-secondary">{{ flight.arrival_airport }}</small>
                                </div>
                            </div>
                            <div class="text-center mt-2">
                                <small class="text-secondary">{{ flight.dep_city }} → {{ flight.arr_city }}</small>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                             <div class="fs-5 fw-bold text-primary">${{ "%.0f"|format(flight.base_price) }}</div>
                             <small class="text-{{ 'success' if flight.status == 'on-time' else 'warning' }}">{{ flight.status }}</small>
                        </div>
                        <div class="col-md-2 text-end">
                            {% if flight.available_seats > 0 %}
                            <a href="{{ url_for('customer_purchase', airline_name=flight.airline_name, flight_number=flight.flight_number, departure_timestamp=flight.departure_timestamp) }}" class="btn btn-primary w-100">Select</a>
                            {% else %}
                            <button class="btn btn-secondary w-100" disabled>Sold Out</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% if round_trip and return_flights %}
        <h4 class="mb-4 fw-bold mt-5">Return Flights</h4>
        <div class="d-flex flex-column gap-3">
            {% for flight in return_flights %}
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <h5 class="mb-0 fw-bold">{{ flight.airline_name }}</h5>
                            <small class="text-secondary">{{ flight.flight_number }}</small>
                        </div>
                        <div class="col-md-5">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="text-center">
                                    <div class="fs-4 fw-bold">{{ flight.departure_timestamp.strftime('%H:%M') }}</div>
                                    <small class="text-secondary">{{ flight.departure_airport }}</small>
                                </div>
                                <div class="text-center px-3">
                                    <span class="text-secondary" style="font-size: 20px;">✈</span>
                                </div>
                                <div class="text-center">
                                    <div class="fs-4 fw-bold">{{ flight.arrival_timestamp.strftime('%H:%M') }}</div>
                                    <small class="text-secondary">{{ flight.arrival_airport }}</small>
                                </div>
                            </div>
                            <div class="text-center mt-2">
                                <small class="text-secondary">{{ flight.dep_city }} → {{ flight.arr_city }}</small>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                             <div class="fs-5 fw-bold text-primary">${{ "%.0f"|format(flight.base_price) }}</div>
                             <small class="text-{{ 'success' if flight.status == 'on-time' else 'warning' }}">{{ flight.status }}</small>
                        </div>
                        <div class="col-md-2 text-end">
                            {% if flight.available_seats > 0 %}
                            <a href="{{ url_for('customer_purchase', airline_name=flight.airline_name, flight_number=flight.flight_number, departure_timestamp=flight.departure_timestamp) }}" class="btn btn-primary w-100">Select</a>
                            {% else %}
                            <button class="btn btn-secondary w-100" disabled>Sold Out</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}